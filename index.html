<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Rat Condition Check</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    h2 {
      text-align: center;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    .score-group {
      margin-top: 5px;
    }
    .score-group label {
      font-weight: normal;
      display: block;
      margin-left: 10px;
    }
    .total {
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
    }
    button {
      margin-top: 20px;
      background: #2c7be5;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #1a5dcc;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Rat 상태 간이 평가표</h2>

  <label>날짜</label>
  <input type="text" id="date" readonly>

  <label>Cohort 번호</label>
  <input type="number" id="cohort" placeholder="예: 11">

  <label>Rat 번호</label>
  <input type="number" id="rat" placeholder="예: 1">

  <label>활동성</label>
  <div class="score-group">
    <label><input type="radio" name="activity" value="1"> 1 - 거의 움직이지 않음</label>
    <label><input type="radio" name="activity" value="2"> 2 - 자극 시 미약한 반응</label>
    <label><input type="radio" name="activity" value="3"> 3 - 보통 수준</label>
    <label><input type="radio" name="activity" value="4"> 4 - 활발함</label>
    <label><input type="radio" name="activity" value="5"> 5 - 매우 활발</label>
  </div>

  <label>털 상태</label>
  <div class="score-group">
    <label><input type="radio" name="fur" value="1"> 1 - 심하게 거칠고 탈모</label>
    <label><input type="radio" name="fur" value="2"> 2 - 윤기 거의 없음</label>
    <label><input type="radio" name="fur" value="3"> 3 - 보통</label>
    <label><input type="radio" name="fur" value="4"> 4 - 윤기 있음</label>
    <label><input type="radio" name="fur" value="5"> 5 - 매우 깨끗</label>
  </div>

  <label>눈 상태</label>
  <div class="score-group">
    <label><input type="radio" name="eye" value="1"> 1 - 심한 분비물/염증</label>
    <label><input type="radio" name="eye" value="2"> 2 - 분비물 있음</label>
    <label><input type="radio" name="eye" value="3"> 3 - 보통</label>
    <label><input type="radio" name="eye" value="4"> 4 - 맑음</label>
    <label><input type="radio" name="eye" value="5"> 5 - 매우 깨끗</label>
  </div>

  <label>특이사항</label>
  <textarea id="note" rows="3" placeholder="특이사항 기록"></textarea>

  <div class="total">
    총점: <span id="total">0</span>
  </div>

  <button onclick="submitForm()">저장</button>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbwkdIkE_uTgMWPtzYzx-h3nXsIfsNHe26ddyF4fJrLYTYKU_8gcfA2lzejLRr3mgWbv/exec";

  // 날짜 자동 입력
  document.getElementById("date").value = new Date().toISOString().slice(0, 10);

  // 점수 변경 시 총합 계산
  document.querySelectorAll("input[type=radio]").forEach(el => {
    el.addEventListener("change", calculateTotal);
  });

  function getScore(name) {
    const checked = document.querySelector(`input[name="${name}"]:checked`);
    return checked ? parseInt(checked.value) : 0;
  }

  function calculateTotal() {
    const total =
      getScore("activity") +
      getScore("fur") +
      getScore("eye");
    document.getElementById("total").innerText = total;
  }

  function submitForm() {
    const cohort = document.getElementById("cohort").value;
    const rat = document.getElementById("rat").value;

    if (!cohort || !rat) {
      alert("Cohort 번호와 Rat 번호를 입력하세요.");
      return;
    }

    if (
      getScore("activity") === 0 ||
      getScore("fur") === 0 ||
      getScore("eye") === 0
    ) {
      alert("모든 평가 항목을 선택하세요.");
      return;
    }

    const formData = new FormData();
    formData.append("cohort", cohort);
    formData.append("rat", rat);
    formData.append("activity", getScore("activity"));
    formData.append("fur", getScore("fur"));
    formData.append("eye", getScore("eye"));
    formData.append("total", document.getElementById("total").innerText);
    formData.append("note", document.getElementById("note").value);

    fetch(scriptURL, {
      method: "POST",
      body: formData
    })
    .then(() => {
      alert("저장 완료");
      location.reload();
    })
    .catch(() => {
      alert("저장 중 오류 발생");
    });
  }
</script>
</body>
</html>

